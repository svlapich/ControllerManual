# Содержание

#### Описание надстройки и ее использование
+ [Описание надстройки](#ch0p1)
+ [Подключение к Eplan](#ch0p2)
+ [Описание автоматически генерируемых Lua-файлов](#13-Описание-автоматически-генерируемых-Lua-файлов)

#### Оборудование IO
+ [Привязка устройств к модулям IO](#ch1)
    + [Привязка пневмоострова Festo (VTUG)](#2.1-Привязка-пневмоострова-Festo-(VTUG))

#### Операции Eplan
+ [Объекты технологической схемы](#ch2)
    + [Операции объектов](#ch2p1)
    + [Схемы](#ch2p2)

#### Устройства технологической схемы
+ [Нумерация устройств](#ch3p1)
    + [Площадка](#ch3p1s1)
    + [Проект](#ch3p1s2)
    + [Технологический объект](#ch3p1s3)
    + [Пользовательский объект](#ch3p1s4)
    + [Устройство](#ch3p1s5)
+ [Перечень устройств](#ch3p2)
    + [HA. Аварийная звуковая сигнализация. Сирена](#ch3p2s1)
    + [FQT. Счетчик](#ch3p2s2)
    + [HL. Световая сигнализация](#ch3p2s3)
    + [LT. Текущий уровень](#ch3p2s4)
    + [GS. Датчик положения](#ch3p2s5)
    + [M. Мотор (электродвигатель)](#ch3p2s6)
    + [FS. Датчик наличия потока](#ch3p2s7)
    + [LS. Предельный уровень](#ch3p2s8)
    + [QT. Датчик проводимости](#ch3p2s9)
    + [TE. Температура](#ch3p2s10)
    + [SB. Кнопка](#ch3p2s11)
    + [V. Клапан](#ch3p2s12)
    + [VC. Управляемый клапан](#ch3p2s13)
    + [DO. Управляющий (выходной) сигнал](#ch3p2s14)
    + [DI. Входной сигнал](#ch3p2s15)
    + [AO. Выходная величина](#ch3p2s16)
    + [AI. Входная величина](#ch3p2s17)
    + [WT. Датчик веса](#ch3p2s18)
    + [PT. Датчик давления](#ch3p2s19)
+ [Дополнительные параметры](#ch3p3)
    + [Описание устройства](#ch3p3s1)
    + [Назначение дополнительных полей](#ch3p3s2)

#### Редактирование технологических объектов
+ [Общие сведения о технологических объектах](#ch4)
+ [Описание окна редактора](#ch4p1)
    + [Добавление устройств в операции в текстовом виде](#ch4p1s1)
    + [Добавление устройств в операции в графическом виде](#ch4p1s2)
    + [Добавление устройств в операции в табличном режиме](#ch4p1s3)
    + [Сохранение результатов редактирования](#ch4p1s4)
+ [Использование функциональности базового объекта и базовой операции](#ch4p2)
    + [Использование базового объекта и новых полей](#ch4p2s1)
    + [Использование базовой операции](#ch4p2s2)
    + [Рекомендации по использованию ОУ (обозначений устройств) в объектах](#ch4p2s3)

#### Установка ограничений
+ [Установка ограничений в табличном виде](#ch5)

## <a name="ch0"></a> 1 Описание надстройки и ее использование

### <a name="ch0p1"></a> 1.1 Описание надстройки
<p align="justify">Надстройка EasyEPlanner разработана как Add-In к EPLAN, на данный момент используется EPLAN 2.8. Надстройка используется при разработке проектов в EPLAN и позволяет автоматизировать работу
инженера по автоматизации, а так же инженера-программиста, который описывает проект на языке программирования LUA. С помощью EasyEPlanner описываются технологические объекты (Танк, Бойлер и др.), операции этих объектов, шаги операций, устанавливаются ограничения для операций, а так же множество других свойств технологического объекта. В конечном итоге, EasyEPlanner генерирует LUA файлы, которые загружаются в контроллер.</p>

### <a name="ch0p2"></a> 1.2 Подключение к Eplan
<p align="justify">Для того, что бы использовать EasyEPlanner, необходимо подключиться к SVN каталогу "<b>https://10.0.16.7/svn/ptusa/trunk/EasyEPlanner%202.8</b>" и обновить его, с помощью SVN Update. Далее, необходимо запустить EPLAN и в меню и перейти в <b>Сервисные программы -> API-Addins</b>. В появившемся окне необходимо нажать кнопку "</b>Загрузить</b>", откроется диалоговое окно, в котором необходимо перейти в папку с надстройкой и выбрать файл "<b>EPLAN.EplAddin.EasyEPlanner.dll</b>", а после нажать кнопку "<b>Открыть</b>". Надстройка загрузится, и появится пункт меню "<b>EPlaner</b>".</p>
<p align="justify"><b>ВАЖНО</b>: Периодически обновляйте папку с надстройкой через SVN, а так же, не удаляйте файлы из папки, иначе работа надстройки не гарантируется!</p>

### 1.3 Описание автоматически генерируемых Lua-файлов ### 
Дополнение EasyEPLANner автоматически генерирует некоторые файлы управляющей программы контроллера. Данные файлы находятся в следующем каталоге: **P:\PTUSA projects\projects\Название проекта**. Также необходимо учесть, что для того, что бы файлы успешно генерировались, необходимо, что бы в системе уже были папки `PTUSA projects` и `projects` на диске **P** (_это задано системно_).

Список файлов, описывающих проект:

- __*main.plua*__ - описание управляющей программы. При отсутствии данного файла, он генерируется автоматически с шаблонами необходимых функций. Если данный файл уже существует, то тогда он остаётся прежним;
- __*main.wago.lua*__ - описание привязки устройств к модулям I/O Wago. В данном файле вначале идет список удаленных узлов (BC - bus couplers) с указанием их параметров (IP-адрес, тип и т.п.) и наполнения - модулей ввода/вывода (I/O modules). Далее идет список технологических устройств (S88 term - control modules) с указанием каналов ввода\вывода, которые с ними связаны. Внутри каналов описывается к какому BC они привязаны, к каким портам подключены и смещения адресного пространства. Помимо каналов внутри технологических устройств могут быть его различные параметры.
- __*main.io.lua*__ - описание привязки устройств к модулям I/O (_Полная копия **main.wago.lua**_);
- __*main.devices.lua*__ - описывает список всех устройств проекта. В файле переменным Lua присваиваются устройства из проекта, с которыми в последствии будет работать ПЛК;
- __*main.modbus_srv.lua*__ - описание взаимодействия с modbus-клиентами;
- __*main.objects.lua*__ - описание объектов проекта. Описание из редактора технологических объектов. Сначала описываются технологические объекты (_Танк, Бойлер и др._). Внутри этих объектов могут описываться различные параметры, таймеры, указываться свойства этого объекта, а так же список операций с шагами и действиями;
- __*main.profibus.lua*__ - описание profibus шины;
- __*main.restrictions.lua*__ - описание ограничений, которые устанавливаются для технологических объектов через редактор технологических объектов. Устанавливаются в числовом виде, поэтому лучше просматривать их через редактор в EPLAN;
- __*main.rm_PACs.lua*__ - описание взаимодействия с удаленными PAC. Находится в бета-версии.
- __*prg.lua*__ - описание базовой функциональности объектов. В текущей реализации в файле сначала описываются переменные, к которым присваиваются те или иные объекты, после идет добавление базовой функциональности, в перспективе будет добавлена так же базовая инициализация объектов. Файл генерируется так же на основе данных редактора технологических устройств.

На текущий момент файлы **main.wago.lua** и **main.io.lua** имеют одно и то же содержание, потому что они используются в разных версиях управляющей программы. В старых проектах используется файл **main.wago.lua** (*до EPLAN 2.8*), а в новых (*нынешних*) проектах используется **main.io.lua**.

## <a name="ch1"></a> 2 Привязка устройств к модулям IO

<p align="justify">Для связывания клеммы модуля ввода-вывода и устройства необходимо чтобы функциональный текст (клеммы) соответствовал названию канала устройства. Для упрощения данной процедуры реализовано окно списком устройств и каналов.</p>

<p align="center"><img src="images/devices_form.png"></p>

<p align="center"><b>Рисунок</b> - <i>Окно "Устройства"</i></p>

<p align="justify">Вызов данного окна осуществляется через пункт меню <b>"EPlaner" -> "Устройства"</b></p>

<p align="center"><img src="images/device_form_path.png"></p>

<p align="center"><b>Рисунок</b> - <i>Путь к окну "Устройства"</i></p>

<p align="justify">Для привязки клеммы необходимо при активном функциональном тексте клеммы <b>дважды</b> нажать (<i>double click</i>) на требуемый канал в окне устройств (<i>пример, выделено зеленым</i>).</p>

<p align="center"><img src="images/assign_channel_to_plc.png"></p>

<p align="center"><b>Рисунок</b> - <i>Пример привязки к модулю ввода-вывода</i></p>

<p align="justify">После двойного клика соответствующий текст автоматически занесется в функциональный текст. При необходимости привязки более одного устройства к одной и той же клемме необходимо <b>зажать</b> при этом клавишу <b>Ctrl</b> (<i>к тексту допишется данное устройство</i>). Для размещения названия устройства на новой строке, необходимо пользоваться символом новой строки (¶), необходимо вставить символ между строками (<i>например, скопировав его предварительно из Word</i>).</p>
<p align="center"><img src="images/functional_text_example.png"></p>

<p align="center"><b>Рисунок</b> - <i>Пример функционального текста</i></p>

<p align="center"><img src="images/functional_text_display_example.png"></p>

<p align="center"><b>Рисунок</b> - <i>Отображение введенного функционального текста</i></p>

### 2.1 Привязка пневмоострова Festo (VTUG) ##

Пневмоостров Festo (_DEV_VTUG - старые проекты, Y - новые_) поддерживает обычную привязку к своим клеммам, а так же множественную привязку. Важно, что бы привязка осуществилась - это наличие привязки самого пневмоострова к клемме модуля ПЛК.

На электрической схеме указывается, к какой клемме ПЛК привязан пневмоостров, а на схеме обзора пневмоострова происходит привязка клапанов к клеммам пневмоострова.

## <a name="ch2"></a> 3 Объекты технологической схемы

<p align="justify">Объектами являются физические танки, линии и т.д. Логически они делятся на аппараты, агрегаты, блоки управления.</p>

### <a name="ch2p1"></a> 3.1 Операции объектов
<p align="justify">Операции может включать оператор. Во время операции происходит включение\выключение устройств, обработка значений с датчиков и т.д. Операции выделяются исходя из системного подхода. Операции разделяются на <i>основные</i> и <i>вспомогательные</i>. Каждая операция имеет название, характеризуется единым для всех проектов описанием (<i>т.е. операция “наполнение” одинакова для всех проектов и характеризуется следующими параметрами: объемом наполнения, проводимость смеси, проводимость воды</i>). Операции описываются в графическом виде в редакторе операций Eplaner.</p>

Для операции определяется:
1.	Номера операций, на которые можно перейти после данной операцию (_из схемы операций_).
2.	Значения параметров, необходимые для выполнения операции.

Операции состоят из шагов. Операция может находится в состоянии __выполнение__, __пауза__, __остановка__.

<p align="center"><img src="images/transition_between_operations.png"></p>

<p align="center"><b>Рисунок</b> - <i>Переход между состояниями операций</i></p>

### <a name="ch2p2"></a> 3.2 Схемы
<p align="center"><img src="images/operations_descr_in_eplan.png"></p>

<p align="center"><b>Рисунок</b> - <i>Схема описания операций в Eplan</i></p>

<p align="center"><img src="images/operations_descr.png"></p>

<p align="center"><b>Рисунок</b> - <i>Схема операций</i></p>

## 4 Устройства технологической схемы

### <a name="ch3p1"></a> 4.1 Нумерация устройств
Для идентификации используются заглавные латинские символы, символ подчеркивания, спецсимволы  (<b>==</b> ,<b>=</b> , <b>+</b>, <b>-</b>) и <b>цифры</b>.

Идентификация объектов осуществляется следующим обозначением:  
<b>==</b> площадка <b>=</b> проект <b>+</b> технологический объект <b>#</b> пользовательский объект <b>-</b> устройство.

Пример:  
<b>==</b> BR <b>=</b> KHUT <b>+</b> COAG <b>-</b> V1 – клапан V1 коагулятора 1 для проекта Хуторки на заводе в Бресте;  
<b>==</b> BR <b>=</b> KHUT <b>+</b> C <b>-</b> V2 – клапан V2 линии С1 для проекта Хуторки на заводе в Бресте.

#### <a name="ch3p1s1"></a> 4.1.1 Площадка
Заводские площадки могут принимать следующие значения:
* __BR1__ – Брест, главный завод;
* __BR2__ -  Брест, новый завод;
* __BZ1__ - Березовский филиал;
* __О__ - Орша, завод
* __К__ - Копысь, завод
* __P__ – Пинский филиал;
* __K__ – Каменецкий филиал;
* __S__ – Столинский филиал.

#### <a name="ch3p1s2"></a> 4.1.2 Проект
Для идентификации используется сокращенное название проекта латинскими буквами и номер. 
Примеры типовых проектов:
* __MCA__ – моечная станция;
* __KHUT__ – «Хуторки».

#### <a name="ch3p1s3"></a> 4.1.3 Технологический объект
Название технологического объекта (_танка, линии…_).
Примеры типовых технологических объектов:
* __M2__ – молочная линия №2;
* __COAG2__ – коагулятор №2;
* __TCW1__ – бочек с холодной водой №1;
* __THW1__ – бочек с горячей водой №1.

#### <a name="ch3p1s4"></a> 4.1.4 Пользовательский объект
Содержит дополнительную информацию.

#### <a name="ch3p1s5"></a> 4.1.5 Устройство
<p align="justify">Содержит код устройства и номер (<i><b>V1</b> – клапан №1</i>). Устройство уникально в пределах технологического объекта.</p>

### <a name="ch3p2"></a> 4.2 Перечень устройств
<p align="justify">Ниже приведено описание используемых технологических устройств. Для каждого устройства также могут задаваться дополнительные поля (<i>смотри раздел <b>3.3</b> "Дополнительные параметры"</i>).</p>

#### <a name="ch3p2s1"></a> 4.2.1 HA. Аварийная звуковая сигнализация. Сирена
Обозначение: __HA__.  
Каналы ввода/вывода: __DO__ – _1_.  
Пример: __HA1__. Аварийная звуковая сигнализация. Сирена.

<p align="center"><img src="images/HA_device.png"></p>

<p align="center"><b>Рисунок</b> - <i>Пример аварийной звуковой сигнализации, сирены</i></p>

#### <a name="ch3p2s2"></a> 4.2.2 FQT. Счетчик
Обозначение: **FQT**.  
Каналы ввода/вывода: **AI** – _2_.  
Название каналов: __AI1__ – _поток_, __AI2__ – _объем_.  
Пример: __+P1-FQT1__. Линия P1. Объем.

#### <a name="ch3p2s3"></a> 4.2.3 HL. Световая сигнализация
Обозначение: __HL__.  
Каналы ввода/вывода: __DO__ – _1_.  
Пример: __HL1__. Аварийная сигнализация. Зеленый.

#### <a name="ch3p2s4"></a> 4.2.4 LT. Текущий уровень
Обозначение: __LT__.  
Каналы ввода/вывода: __AI__ – _1_.  
Пример: __+TANK1-LT1__. Танк №1. Текущий уровень.

#### <a name="ch3p2s5"></a> 4.2.5 GS. Датчик положения
Обозначение: **GS**.  
Каналы ввода/вывода: **DI** – *1*.  
Пример: **+TANK2-GS1**. Танк №2. Датчик люка.

#### <a name="ch3p2s6"></a> 4.2.6 Мотор (электродвигатель)
Обозначение: **M**.  
Каналы ввода/вывода: **DO** – *2*, **DI** – *1*, **AO** – *8*.  
Название каналов: **DO1** – *пуск*, **DO2** – *реверс*, **DI1** – *обратная связь*, **AO1** – *частота вращения*.  
Пример: **+T1-M1**. Линия T1. Пуск.

#### <a name="ch3p2s7"></a> 4.2.7 Датчик наличия потока
Обозначение: **FS**.  
Каналы ввода/вывода: **DI** – *1*.  
Пример: **FS1**. Датчик наличия потока.

#### <a name="ch3p2s8"></a> 4.2.8 LS. Предельный уровень
Обозначение: **LS**.  
Каналы ввода/вывода: **DI** – *1*.  
Дополнительные поля: 
* Тип подключения: _max_, _min_.

Пример: **+TANK1-LS2**. Танк №1. Верхний уровень.

#### <a name="ch3p2s9"></a> 4.2.9 QT. Датчик проводимости
Обозначение: **QT**.  
Каналы ввода/вывода: **AI** – _1_.  
Пример: **МСА3+-QT1**. MCA3. Датчик проводимости.

#### <a name="ch3p2s10"></a> 4.2.10 TE. Температура
Обозначение: **TE**.  
Каналы ввода/вывода: **AI** – *1*.  
Пример: **+TANK1-TE1**. Танк №1. Температура.

#### <a name="ch3p2s11"></a> 4.2.11 SB. Кнопка
Обозначение: **SB**.  
Каналы ввода/вывода: **DI** – *1*.  
Пример: **+TANK1-SB1**. Танк №1. В дренаж.

#### <a name="ch3p2s12"></a> 4.2.12 V. Клапан
Обозначение: **V**.  
Каналы ввода/вывода: *зависит от типа клапана*.  
Название каналов: **DO** – *открыть НС*, *открыть ВС*, *открыть*, *закрыть*, *открыть мини*; **DI** – *открыт*, *закрыт*.  
Пример: **+TANK1-V7**. Танк №1. Дренаж.

#### <a name="ch3p2s13"></a> 4.2.13 VC. Управляемый клапан
Обозначение: **VС**.  
Каналы ввода/вывода: **AO** – *1*.  
Пример: **VC3**. Паровой клапан.

#### <a name="ch3p2s14"></a> 4.2.14 DO. Управляющий (выходной) сигнал
Обозначение: **DO**.  
Каналы ввода/вывода: **DO** – *1*.  
Пример: **MCA2+-DO2**. МСА 2. Готовность объекта CIP

#### <a name="ch3p2s15"></a> 4.2.15 DI. Входной сигнал
Обозначение: **DI**.  
Каналы ввода/вывода: **DI** – *1*.  
Пример: **DI10**. Приемник готов.

#### <a name="ch3p2s16"></a> 4.2.16 AO. Выходная величина
Обозначение: **AO**.  
Каналы ввода/вывода: **AO** – *1*.  
Пример: **AO1**. Задание производительности.

#### <a name="ch3p2s17"></a> 4.2.17 AI. Входная величина
Обозначение: **AI**.  
Каналы ввода/вывода: **AI** – *1*.  
Пример: **AI1**. Ток двигателя.

#### <a name="ch3p2s18"></a> 4.2.18 WT. Датчик веса
Обозначение: **WT**.  
Каналы ввода/вывода: **AI** – *2*.  
Пример: **WT1**. Весы танка 1.

#### <a name="ch3p2s19"></a> 4.2.19 PT. Датчик давления
Обозначение: **PT**.  
Каналы ввода/вывода: **AI** – *1*.  
Пример: **MCA3+-PT10**. MCA3.  Датчик давления.

### <a name="ch3p3"></a> 4.3 Дополнительные параметры
Дополнительные параметры указываются через свойства устройства.

#### <a name="ch3p3s1"></a> 4.3.1 Описание устройства
В поле «Примечание» записывается описание устройства. Пример смотри ниже.

<p align="center"><img src="images/dev_note.png"></p>

<p align="center"><b>Рисунок</b> - <i>Запись описания устройства</i></p>

#### <a name="ch3p3s2"></a>  4.3.2 Назначение дополнительных полей
1. **Доп. поле [1]**. Определяет обрабатывать или нет данное устройство при экспорте для PAC (_например, ручная заслонка не управляется автоматически_). Если оно содержит значение - **1**, то данное устройство не обрабатывается.</p>
2. **Доп. поле [2]**. Определяет тип. Описание:

Параметр | Описание
------------ | -------------
V_DO1 | Клапан с одним каналом управления.
V_DO2 |Клапан с двумя каналами управления.
V_DO1_DI1_FB_OFF |Клапан с одним каналом управления и одной обратной связью (_выключенное состояние_).
V_DO1_DI1_FB_ON | Клапан с одним каналом управления и одной обратной связью (_включенное состояние_).
V_DO1_DI2 | Клапан с одним каналом управления и двумя обратными связями.
V_DO2_DI2 | Клапан с двумя каналами управления и двумя обратными связями.
V_MIXPROOF | Клапан противосмешивающий (_2 канала управления и 2 обратные связи_).
AS_MIXPROOF | Клапан противосмешивающий с **AS интерфейсом**.
BOTTOM_MIXPROOF | Клапан донный. 
AS_DO1_DI2 | Клапан с одним каналом управления и двумя обратными связями с **AS интерфейсом**.
V_DO2_DI2_BISTABLE | Клапан с двумя каналами управления и двумя обратными связями бистабильный.
V_IOLINK_VTUG_DO1 | **IO-Link VTUG** клапан с одним каналом управления.
V_IOLINK_VTUG_DO1_FB_OFF | **IO-Link VTUG** клапан с одним каналом управления и одной обратной связью (_выключенное состояние_).
V_IOLINK_VTUG_DO1_FB_ON | **IO-Link VTUG** клапан с одним каналом управления и одной обратной связью (_включенное состояние_).
LS_MIN | Предельный уровень по схеме минимум.
LS_MAX | Предельный уровень по схеме максимум.
LS_IOLINK_MIN | **IO-Link** уровень. Подключение по схеме минимум.
LS_IOLINK_MAX | **IO-Link** уровень. Подключение по схеме максимум.
TE | Температура
TE_CONE | Датчик для танка цилиндрической формы
TE_CYL | Датчик для цилиндрического с конусом танка
TE_IOLINK | Температура **IO-Link** без дополнительных параметров.
M | Мотор без управления частотой вращения.
M_FREQ | Мотор с управлением частотой вращения.
M_REV | Мотор с реверсом (*совместный*) без управления частотой вращения.
M_REV_FREQ | Мотор с реверсом (*совместный*) с управлением частотой вращения.
M_REV_2 | Мотор с реверсом (*отдельный*) без управления частотой вращения.
M_REV_FREQ_2 | Мотор с реверсом (*отдельный*) с управлением частотой вращения.
M_REV_2_ERROR | Мотор с реверсом (*отдельный*). Отдельный сигнал аварии.
M_REV_FREQ_2_ERROR | Мотор с реверсом с управлением частотой вращения. Реверс включается отдельно. Отдельный сигнал ошибки.
M_ATV | Мотор, управляемый частотным преобразователем Altivar. Связь с частотным преобразователем по Ethernet. Реверс и аварии опциональны.
FQT | Счетчик.
FQT_F | Счетчик с расходом.
FQT_F_OK | Счетчик с расходом с диагностикой.
FQT_VIRT | Виртуальный счетчик (*без привязки к модулям*).
QT | Концентратомер.
QT_OK | Концентратомер с диагностикой.
QT_IOLINK | **IO-Link** концентратомер.
LT | Датчик текущего уровня
LT_CYL | Датчик для танка цилиндрической формы
LT_CONE | Датчик для цилиндрического с конусом танка
LT_IOLINK | **IO-Link** текущий уровень без дополнительных параметров.
DI_VIRT | Виртуальный дискретный входной сигнал
АI_VIRT | Виртуальный аналоговый входной сигнал
DO_VIRT | Виртуальный дискретный входной сигнал
АО_VIRT | Виртуальный аналоговый выходной сигнал
Y | Пневмоостров Festo
DEV_VTUG_8 | SPECIAL Festo valve terminal
DEV_VTUG_16 | SPECIAL Festo valve terminal
DEV_VTUG_24 | SPECIAL Festo valve terminal

Пример приведен ниже:

<p align="center"><img src="images/dev_supl_field_2.png"></p>

<p align="center"><b>Рисунок</b> - <i>Пример добавления типа устройству</i></p>

3. **Доп. поле [3]**. Определяет дополнительные параметры. 
Параметры задаются в следующем виде: **«имя_параметра»=«значение_параметра»**. 
Список параметров приведен ниже.

<p align="center"><img src="images/dev_supl_field_3.png"></p>

<p align="center"><b>Рисунок</b> - <i>Пример добавления доп. параметров к устройству</i></p>

* ___V___
    * __P_ON_TIME__		Время включения, _мс_. (_Для клапанов с обратной связью_).

* ___AI___
    * __P_C0__ - Сдвиг нуля.
    * __P_MIN_V__ -	Минимальное значение.
    * __P_MAX_V__ -	Максимальное значение.

* ___AO___
    * __P_MIN_V__ -	Минимальное значение.
    * __P_MAX_V__ -	Максимальное значение.

* ___FS___
    * __P_DT__ - Время порогового фильтра, _мс_.

* ___QT___
    * __P_C0__ - Сдвиг нуля.
    * __P_MIN_V__ - Минимальное значение.
    * __P_MAX_V__ - Максимальное значение.

* ___GS___
    * __P_DT__ - Время порогового фильтра, _мс_.

* ___LS___
    * __P_DT__ - Время порогового фильтра, _мс_.

* ___DI___
    * __P_DT__ - Время порогового фильтра, _мс_.

* ___LT___
    * __P_C0__ - Сдвиг нуля.

* ___LT_CYL___
    * __P_C0__ - Сдвиг нуля.
    * __P_MAX_P__ - Давление, на которое настроен датчик, _бар_.
    * __P_R__ - Радиус танка, _м_.

* ___LT_CONE___
    * __P_C0__ - Сдвиг нуля.
    * __P_MAX_P__ - Давление, на которое настроен датчик, _бар_.
    * __P_R__ - Радиус танка, _м_.
    * __P_H_CONE__ - Высота конической части танка, _м_.

* ___LT_TRUNC___
    * __P_C0__ - Сдвиг нуля.
    * __P_MAX_P__ - Давление, на которое настроен датчик, _бар_.
    * __P_R__ - Радиус танка, _м_.
    * __P_H_TRUNC__ - Высота усеченной части танка, _м_.

* ___TE___
    * __P_C0__ - Сдвиг нуля.
    * __P_ERR__ - Аварийное значение температуры.

* ___M___
    * __P_ON_TIME__ - Время включения, _мс_.

* ___FQT___
    * __P_C0__ - Сдвиг нуля.
    * __P_MIN_F__ - Минимальное значение потока.
    * __P_MAX_F__ - Максимальное значение потока.
    * __P_DT__ - Время ожидания появления расхода после включения связанного насоса, _мс_.

* ___WT___
    * __P_C0__ - Сдвиг нуля, _кг_.
    * __P_DT__ - Точность датчика, в _кг_. Для фильтрации.
    * __P_NOMINAL_W__ - Характеристика датчика: номинальный вес, _кг_.
    * __P_RKP__ - Характеристика датчика: рабочий коэффициент передачи, _мВ/В_.

* ___PT___
    * __P_C0__ - Сдвиг нуля, _ед_.
    * __P_MIN_V__ - Минимальное значение.
    * __P_MAX_V__ - Максимальное значение.

4. **Доп. поле [4]**. Определяет дополнительные свойства. Свойства задаются в следующем виде: **«имя_свойства»=«’значение_ свойства’»**. Список свойств описан ниже. Если нет значения свойства, то тогда оно устанавливается в пустое значение (_например, связанный насос для счетчика – **MT=''**_).

* ___FQT___
    * __MT__ - Насосы, качающие через данный счетчик. Необходимы для анализа работоспособности счетчика (_насос работает – счетчик должен показывать расход_).

* ___DO___
    * __DST__ - Получатель сигнала.
* ___DI___
    * __SRC__ - Отправитель сигнал.

5.	**Доп. поле [5]**. Определяет дополнительные рабочие параметры.  Рабочие параметры всегда устанавливаются при загрузке контроллера, они хранятся в оперативной памяти и не передаются на сервер. Рабочие параметры задаются в следующем виде: **«имя_рабочего_параметра»=«значение_рабочего_параметра»**. Список рабочих параметров приведен ниже.

* ___V___
    * **R_AS_NUMBER** - AS-номер, с единицы. (_Для клапанов с **AS-интерфейсом**_).
    * **R_VTUG_NUMBER** - VTUG-номер, с единицы. (_Для клапанов с **IO-Link интерфейсом**_).

## <a name="ch4"></a> 5 Общие сведения о технологических объектах

<p align="justify"><b>Технологический процесс</b> (<em>техпроцесс</em>) – процесс производства какого-либо продукта (<em>полуфабриката</em>).</br>
<b>Технологический объект</b> - объект, в котором (<em>который</em>) непосредственно осуществляется (<em>осуществляет</em>) техпроцесс. Технологический объект характеризуется наличием связанными с ним операциями. К технологическим объектам относятся танк, гребенка, автомат и т.д.</br>
<b>Операция</b> – часть техпроцесса, которую непосредственно может запустить (<em>включить</em>) или остановить (<em>выключить</em>) оператор.</br> 
<b>Шаг</b> - часть операции, которой непосредственно не может управлять оператор.
Таким образом, инженер по автоматизации описывает техпроцесс через описание технологических объектов, их операций и шагов, дополнительных параметров.</p>

### <a name="ch4p1"></a> 5.1 Описание окна редактора
<p align="justify">Все объекты представляются в иерархической древовидной структуре. Первый уровень – проект, второй – технологические объекты (<em>аппарат, агрегат</em>), третий – свойства технологических объектов.</p>

<p align="center"><img src="images/techobject_descr.png"></p>

<p align="center"><b>Рисунок</b> - <i>Пример иерархии объектов</i></p>

Для редактирования любого узла дерева применяются следующие команды (_клавиши_):
* удаление – **DEL**,
* вставка – **INS**,
* редактирование текстового представления – **клик по активному узлу дерева или F2**,
* отмена редактирования – **ESC** (_во время редактирования_),
* ввод редактирования – **ENTER** (_во время редактирования_),
* копирование узла – **CTR + C**,
* вставка узла – **CTR + V**, при этом надо находиться на родительском узле, куда мы вставляем скопированный элемент.
* вставка узла – **CTR + B**, необходимо находиться на узле, который хотим заменить ранее скопированным,
* перемещение узла вверх – **Shift + Up**,
* перемещение узла вниз – **Shift + Down**.
При копировании – вставке/замене объекта копируются все поля исходного объекта необходимо учитывать следующие нюансы:
* Номер объекта меняется на номер объекта, на место которого вставляем объект
* Копируется полный список операций и происходит копирование устройств, которые используются в операции. При этом происходит корректная замена номера объекта на новый. Это происходит в случае совпадения у двух объектов поля ОУ. Так при копировании операций из объекта __Танк 1__ с устройством __TANK1V1__ и заменой в объекте __Танк 3__ устройство изменит свое имя на __TANK3V1__.
* При копировании операций происходит копирование ограничений, описанных в операции. Для ограничений, относящихся к данному объекту (_«Ограничения внутри объекта», «Ограничения на последующие операции»_), происходит замена старого номера объекта на новый.
* Можно копировать не только отдельные строки параметров, операций, а также целые группы параметров, ограничений, операций.

#### <a name="ch4p1s1"></a> 5.1.1 Добавление устройств в операции в текстовом виде
<p align="justify">Необходимо включить режим редактирования (<em>иконка синего карандаша вверху окна редактора</em>) и выбрать (<em>выделить</em>) нужный узел.</p>

<p align="center"><img src="images/select_node.png"></p>

<p align="center"><b>Рисунок</b> - <i>Пример выбора узла</i></p>

<p align="justify">Далее кликнуть по нему и перейти в режим редактирования.</p>

<p align="center"><img src="images/edit_selected_node.png"></p>

<p align="center"><b>Рисунок</b> - <i>Пример режима редактирования</i></p>

<p align="justify">Последовательно через пробел записать требуемые устройства (<em>как на рисунке с включенным режимом редактирования</em>) и завершить ввод нажав <b>Enter</b> (<em><b>Esc</b> - отмена изменений</em>), получив измененный результат и состояние строки, как на рисунке с примером выбора узла.</p>

#### <a name="ch4p1s2"></a> 5.1.2 Добавление устройств в операции в графическом виде
<p align="justify">Необходимо перейти в данный режим, нажав следующие кнопки:</p>

<p align="center"><img src="images/edit_buttons.png"></p>

<p align="center"><b>Рисунок</b> - <i>Кнопки для работы с графическим режимом</i></p>

<p align="justify">Необходимо выделить нужный узел.</p>

<p align="center"><img src="images/select_node.png"></p>

<p align="center"><b>Рисунок</b> - <i>Выбор узла</i></p>

<p align="justify">На карте подсвечиваются участвующие устройства (устройства <em>выключать</em> - серого цвета, <em>остальное</em> - зеленого цвета).</p>

<p align="center"><img src="images/higlight_dev.png"></p>

<p align="center"><b>Рисунок</b> - <i>Пример подсветки объектов</i></p>

<p align="justify">Путем клика на необходимых устройствах, добавляем или удаляем их из шага. После завершения редактирования шага переходим к следующему (<em>клик по требуемому узлу</em>).</p>

#### <a name="ch4p1s3"></a> 5.1.3 Добавление устройств в операции в табличном режиме
<p align="justify">Необходимо вызвать окно с устройствами, вызвав его из меню (<em>смотри главу 1</em>), или же, если включен режим редактирования (<em>смотри предыдущий подпункт</em>), то окно вызовется само при выборе узла для редактирования.</p>

<p align="center"><img src="images/edit_selected_node_table_mode.png"></p>

<p align="center"><b>Рисунок</b> - <i>Редактирование узла в табличном режиме</i></p>

<p align="justify">Путем отметки (<em>снятия отметки</em>) соответствующие устройства добавляются (<em>удаляются</em>) из действия.</p>

#### <a name="ch4p1s4"></a> 5.1.4 Сохранение результатов редактирования
<p align="justify">Результаты редактирования сохраняются при закрытии проекта (<em>как при закрытии проекта отдельно, так и при закрытии окна EPlan с включенным проектом</em>), а так же с помощью кнопки "Синхронизация и сохранение" (<em>сине-зеленый круг справа на картинке</em>).</p>

<p align="center"><img src="images/edit_buttons.png"></p>

<p align="center"><b>Рисунок</b> - <i>Кнопка сохранения и синхронизации</i></p>

### <a name="ch4p2"></a> 5.2 Использование функциональности базового объекта и базовой операции

#### <a name="ch4p2s1"></a> 5.2.1 Использование базового объекта и новых полей
<p align="justify">Для установки базового объекта, необходимо использовать редактор технологических объектов с включенным режимом редактирования. 
Что бы выбрать базовый объект, нужно два раза нажать на пустую строку напротив названия технологического объекта (<em>прим., Танк, Гребенка, Мастер</em>).</p>

<p align="center"><img src="images/set_base_object.png"></p>

<p align="center"><b>Рисунок</b> - <i>Выбор базового объекта</i></p>

<p align="justify">В технологическом объекте добавлены 2 новых поля: <code>S88Level</code>, <code>Привязанные устройства</code>. Поле <code>Привязанные устройства</code> - указывает глобальные номера объектов,
которые привязаны к этому объекту (<em>прим., к Танку 1 привязан Узел перемешивания 1, см. рисунок</em>).
Поле <code>S88Level</code> - указывает уровень объекта по S88. Стандартное значение поля - <code>1</code> (<em>аппарат</em>), <code>2</code> (<em>агрегат</em>). 
Если объект является агрегатом, то к нему не могут быть привязаны устройства и поле <code>Привязанные устройства</code> заблокируется для редактирования.</p>

<p align="center"><img src="images/work_with_fields_s88_ao.jpg"></p>

<p align="center"><b>Рисунок</b> - <i>Работа с полями S88 и Привязанные устройства</i></p>

##### Примечание:

* Базовый объект выбирается, что бы генерировался файл prg.lua
* Если привязанных устройств больше 1, то привязка осуществляется через _пробел_ (_прим., `number1 number2 numberN`_).
* Поле `S88Level` устанавливается автоматически, в зависимости от выбранного базового объекта.
Во избежание проблем, **строго указывать согласно описанию выше**.

#### <a name="ch4p2s2"></a> 5.2.2 Использование базовой операции
<p align="justify">Выбор базовой операции в базовом объекте осуществляется таким же образом, с тем лишь исключением, что выбирать нужно напротив названия операции.</p>

<p align="center"><img src="images/set_base_oper.png"></p>

<p align="center"><b>Рисунок</b> - <i>Выбор базовой операции</i></p>

<p align="justify">В <code>Операции</code> добавлено ещё один раскрывающийся элемент <code>Дополнительные сигналы</code>. В зависимости от выбранной операции, появляется разное количество полей, которое необходимо заполнить (<em>пока что реализована только Мойка</em>).</p>

<p align="center"><img src="images/extra_oper_params.png"></p>

<p align="center"><b>Рисунок</b> - <i>Дополнительные поля операции</i></p>

##### Примечание:

* Если базовая операция не выбрана, то дополнительных полей не появится.
* Появляющиеся поля используются при формировании prg.lua

#### <a name="ch4p2s3"></a> 5.2.3 Рекомендации по использованию ОУ (_обозначений устройств_) в объектах
* Для линии указывать букву, которая обозначает линию - `B`, `C` и др.
* Для узлов перемешивания/охлаждения/подогрева указывать ОУ - `TANK` (_регистр не важен_).

### <a name="ch5"></a> 6 Установка ограничений

<p align="justify">Для каждой операции в объекте создана дополнительная группа полей: «Ограничения внутри объекта», «Общие ограничения», «Ограничения на последующие операции» , которые предназначены для настройки ограничений для данной операции.</p>

<p align="center"><img src="images/restrictions.png"></p>

<p align="center"><b>Рисунок</b> - <i>Местонахождение ограничений</i></p>

<p align="justify">Ограничения представляются парами вида {N, M}, где <b>N</b> – номер объекта, в котором проверяем на включенность операцию <b>M</b>. Ограничения проверяются перед включением операции, в которой прописываются пары. «Ограничения внутри объекта» предназначены для описания недоступных операций внутри объекта. К примеру, для операции «Наполнение» можем указать операцию «Сквашивание», нам не нужно проверять «Сквашивание» во всех других объектах. «Общие ограничения» описывают недоступные операции с другими объектами. В поле «Ограничения на последующие операции» указываются операции объекта, которые нельзя включить после текущей, например, после операции «Выдача» нельзя включить «Наполнение». Редактировать ограничения можно вручную или через окно со списком операций. Его можно вызвать из меню <b>"EasyEplanner" -> "Операции"</b> (<em>смотри пример в главе 1</em>). Если окно для редактирования технологических объектов находится в режиме редактирования, то при переходе на строку с ограничениями у узлов дерева с операциями появятся _CheckBox_ для выбора необходимых ограничений.</p>

<p align="center"><img src="images/selected_restrictions.png"></p>

<p align="center"><b>Рисунок</b> - <i>Редактирование ограничений</i></p>

<p align="justify">После редактирования и закрытия проекта все ограничения экспортируются в отдельный файл <b>main.restrictions.lua</b>, который в дальнейшем записывается в контроллер. Перезагрузка данного файла возможна без перезагрузки программы. Для работы с ограничениями созданы следующие системные параметры:</p>

* __CMD__ - Для перезагрузки файла ограничений в CMD пишем 100, если все ОК, то вернется 0, иначе 1 и строка с описанием ошибки будет в CMD_ANSWER.
* __CMD_ANSWER__ – Строка с описанием ошибки перезагрузки ограничений.
* __P_RESTRICTIONS_MODE__ – Параметр для включения/выключения ограничений - 0 - авто, 1 - ручной, 2 – полуручной (_через время P_RESTRICTIONS_MANUAL_TIME вернется в автоматический режим_). 
* __P_RESTRICTIONS_MANUAL_TIME__ - Работа модуля ограничений в ручном режиме заданное время, мс.
